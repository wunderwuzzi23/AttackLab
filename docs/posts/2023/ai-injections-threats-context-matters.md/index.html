<!DOCTYPE html>
<html lang="en-us">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" AI Injections Threats: Why context still matters. &middot;  Embrace The Red" />
  
  <meta property="og:site_name" content="Embrace The Red" />
  <meta property="og:url" content="https://embracethered.com/blog/posts/2023/ai-injections-threats-context-matters.md/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:published_time" content="2023-04-07T14:09:46-07:00" />
  
  <meta property="og:article:tag" content="aiml" />
  
  <meta property="og:article:tag" content="machine learning" />
  
  <meta property="og:article:tag" content="red" />
  
  <meta property="og:article:tag" content="threats" />
  
  

  <title>
     AI Injections Threats: Why context still matters. &middot;  Embrace The Red
  </title>

  <link rel="stylesheet" href="https://embracethered.com/blog/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/main.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/github.css" />
  
  <link rel="stylesheet" href="https://embracethered.com/blog/fonts/cachedfonts.css" type="text/css">
  <link rel="shortcut icon" href="https://embracethered.com/blog/images/favicon.ico" />
  <link rel="apple-touch-icon" href="https://embracethered.com/blog/images/apple-touch-icon.png" />
  

  
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@wunderwuzzi23">
<meta name="twitter:title" content="AI Injection Threats: Why context still matters.">
<meta name="twitter:description" content="Discussion of real world threats and data exfiltration scenarios.">
<meta name="twitter:image" content="https://embracethered.com/blog/images/2023/ai_injection2.jpg">

<meta name="twitter:creator" content="@wunderwuzzi23">




  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1739327806831586"
  crossorigin="anonymous"></script>
  
</head>
<body>
    <header class="global-header"  style="background-image:url( /blog/images/bg.png )">
    <section class="header-text">
      <h1><a href="https://embracethered.com/blog/">Embrace The Red</a></h1>
      
      <div class="tag-line" style="min-width:fit-content; font-weight: 400;">
        wunderwuzzi&#39;s blog
        <br><a style="color: greenyellow; font-weight:300;text-decoration: underline; " href="https://www.amazon.com/gp/product/1838828869/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1838828869&linkCode=as2&tag=wunderwuzzi-20&linkId=b6523e937607be47499c6010ff489537">OUT NOW: Cybersecurity Attacks - Red Team Strategies</a> 
      </div>
      
      <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>

      
      <a href="https://embracethered.com/blog/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
    
      <a href="/blog/index.xml" class="btn-header btn-subscribe hidden-xs">
        <i class="fa fa-rss" aria-hidden="true"></i>
        &nbsp;Subscribe
      </a>
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">AI Injections Threats: Why context still matters.</h1>
    <div class="post-meta clearfix">
    
      <div class="post-date pull-left">
        Posted on
        <time datetime="2023-04-07T14:09:46-07:00">
          Apr 7, 2023
        </time>
      </div>
    
      <div class="pull-right">
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/aiml">#aiml</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/machine-learning">#machine learning</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/red">#red</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/threats">#threats</a></span>
        
      </div>
    </div>
  </header>
  <section>
    <p>In the <a href="https://embracethered.com/blog/posts/2023/ai-injections-direct-and-indirect-prompt-injection-basics/">last post we did a deep-dive on AI Injections</a> , with a focus on remote/indirect prompt injections.</p>
<p>These attacks allow an adversary to hijack an AI system that processes untrusted data. Large language models (LLMs) are particularly vulnerable to this threat.</p>
<!-- raw HTML omitted -->
<figure class=".center"><img src="/blog/images/2023/ai_injection2.jpg" width="50%" height="50%"/>
</figure>

<p>If you building/integrating LLMs into your applications, you have to threat model them.</p>
<p>Having said that, I want to discuss why <strong>context <em>still</em> matters</strong>.</p>
<h2 id="context-matters">Context matters!</h2>
<p>While building the fun <a href="https://github.com/wunderwuzzi23/yolo-ai-cmdbot">yolo</a> shell assistant, I had the first interesting realization around LLM useage, their response messages and content.</p>
<p>And more recently I built a Discord bot and started looking at what might go wrong&hellip;</p>
<p>As discussed previously preventing input injections is currently very difficult. There are no easy mitigations for indirect prompt injections. So, this post will focus on the results of an LLM query.</p>
<h2 id="output">Output</h2>
<p>This brings us right to the ouput discussion. Data exfiltration in particular is a real threat that I have seen a few times, and also reported to vendors via responsible disclosure.</p>
<p>Especially if you insert untrusted content into your LLM queries and chat completions the result that comes back is untrusted data.</p>
<p>Since there are challenges with controlling the prompt and behavior of the LLM, consider spending extra cycles on thinking about the output of the AI and what could go wrong.</p>
<blockquote>
<p>The result of a LLM query should alwasy be handled with care, and be considered untrusted. It might contain offensive language, code, or other instructions.</p>
</blockquote>
<h3 id="test-automation-llm-output-fuzzing-and-the-supervisor">Test Automation, LLM Output Fuzzing, and the Supervisor</h3>
<p>I think a good approach can be to build stub for the <code>ChatCompletion</code> call and then start fuzzing the client and bombard it with random responses.</p>
<p><a href="/blog/images/2023/ai_injection.jpg"><img src="/blog/images/2023/ai_injection.jpg" alt="AI Injection"></a></p>
<p>To help with that I created a simple prototype fuzzer using GPT-4.</p>
<h2 id="output-encoding-filtering-and-human-review">Output Encoding, Filtering and Human Review</h2>
<p>What I mean with output encoding is that as architects and engineers we have to understand where we are embedding the AI, what underlying platform capabilities can it directly invoked.</p>
<p>Depending on the context proper encoding has to be applied to prevent the LLM from being able to break or otherwise inject content into the client. This could be as simple as XSS if your client is a web application, or SQL Injection if you use data returned from an LLM in an SQL query. Nothing new here.</p>
<p>What might be worth highlighting specifically is that there will be new kind of client side injections. The client here being the LLM caller.</p>
<p>For instance, if you build a chatbot, consider the following injection threats:</p>
<ul>
<li>LLM returns characters or instructions such as <code>@all</code>, <code>@everyone</code>,&hellip;</li>
<li>LLM returns app specific commands, e.g. <code>/command</code>? Does this lead to invocation of commands? This is often configurable and could lead to security issues during prompt injections.</li>
<li>Some clients might run operating system commands - that&rsquo;s as obvious of a dangerous scenarios as it can get</li>
<li>Hyperlinks. In apps like Discord or Telegram hyperlinks are automatically retrieved. This allows for <strong>data exfiltration</strong> in case carefully crafted responses comes back from a LLM (see a more detailed analysis in the appendix)</li>
<li>Can random links be added, e.g. what happens with tel:+1234567890?</li>
</ul>
<p>As a last resort, also always consider human review.</p>
<p>For instance, when I built yolo, the default mode is that commands are not automatically executed in the shell. The user can review the commands, and run/copy them if they like.</p>
<h2 id="supervisor">Supervisor</h2>
<p>A possible solution could be a &ldquo;supervisor&rdquo; or &ldquo;moderator&rdquo; that watches a conversation to make sure it doesn&rsquo;t derail, but that&rsquo;s also not perfect.</p>
<h3 id="plug-ins-and-tools">Plug-Ins and Tools</h3>
<p>A key point we covered was how the addition of plugins, tools will enable attacks via indirect prompt injections more likely to succeed.</p>
<h2 id="threat-model-your-usage">Threat model your usage</h2>
<p>Threat modeling the scenario and integration carefully will help identity issues early, and allow for proper mitigations.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Context matters. Threat modeling the integration points when you are calling and retrieving information from an AI system, such as an LLM.</p>
<p>Data exfiltration is a real threat, especially if you insert untrusted content into your LLM queries and chat completions.</p>
<p>Cheers.</p>
<h2 id="appendix">Appendix</h2>
<h3 id="data-exfiltration---what-does-the-attacker-see">Data Exfiltration - What does the attacker see</h3>
<p>I reviewed some common chat applications that automatically retrieve hyperlinks. This list isn&rsquo;t complete but those are scenarios that have been evaluated. I have not looked at any Facebook chat apps, since I don&rsquo;t have them installed anymore, but they likely have the same behavior.</p>
<h4 id="discord">Discord</h4>
<pre tabindex="0"><code>[07/Apr/2023:16:16:40 +0000] &quot;GET /discord HTTP/1.1&quot; 404 178 &quot;-&quot; &quot;Mozilla/5.0 (compatible; Discordbot/2.0; +https://discordapp.com)&quot;
</code></pre><h4 id="skype">Skype</h4>
<pre tabindex="0"><code>[07/Apr/2023:16:12:58 +0000] &quot;GET /skype HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) SkypeUriPreview Preview/0.5 skype-url-preview@microsoft.com”
</code></pre><h4 id="slack">Slack</h4>
<pre tabindex="0"><code>[07/Apr/2023:16:07:48 +0000] &quot;GET /posts/bardintro.html HTTP/1.1&quot; 200 687 &quot;-&quot; &quot;Slackbot-LinkExpanding 1.0 (+https://api.slack.com/robots)”
</code></pre><h4 id="telegram">Telegram</h4>
<pre tabindex="0"><code>[07/Apr/2023:16:20:18 +0000] &quot;GET /te HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;TelegramBot (like TwitterBot)&quot;
[07/Apr/2023:16:20:19 +0000] &quot;GET /tele HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;TelegramBot (like TwitterBot)&quot;
[07/Apr/2023:16:20:19 +0000] &quot;GET /teleg HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;TelegramBot (like TwitterBot)&quot;
[07/Apr/2023:16:20:19 +0000] &quot;GET /telegr HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;TelegramBot (like TwitterBot)&quot;
[07/Apr/2023:16:20:19 +0000] &quot;GET /telegra HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;TelegramBot (like TwitterBot)&quot;
[07/Apr/2023:16:20:20 +0000] &quot;GET /telegram HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;TelegramBot (like TwitterBot)”
</code></pre><h4 id="signal">Signal</h4>
<pre tabindex="0"><code>[07/Apr/2023:16:25:07 +0000] &quot;GET /s HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;WhatsApp/2&quot;
[07/Apr/2023:16:25:07 +0000] &quot;GET /si HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;WhatsApp/2&quot;
[07/Apr/2023:16:25:07 +0000] &quot;GET /sig HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;WhatsApp/2&quot;
[07/Apr/2023:16:25:08 +0000] &quot;GET /sign HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;WhatsApp/2&quot;
[07/Apr/2023:16:25:08 +0000] &quot;GET /signa HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;WhatsApp/2&quot;
[07/Apr/2023:16:25:08 +0000] &quot;GET /signal HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;WhatsApp/2”
</code></pre><h4 id="microsoft-teams">Microsoft Teams</h4>
<pre tabindex="0"><code>[07/Apr/2023:17:31:54 +0000] &quot;GET /teams HTTP/1.1&quot; 404 152 &quot;-&quot; &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) SkypeUriPreview Preview/0.5 skype-url-preview@microsoft.com”
</code></pre>
  </section>
  <footer>
    
    
    
    <footer></footer><hr/>
    
    <ul class="pager">
      
      <li class="next disabled"><a href="#">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
      
      <li class="author-contact">
        <a href="mailto:security@wunderwuzzi.net">
          <i class="fa fa-envelope-o" aria-hidden="true"></i>
          &nbsp;Contact me
        </a>
     </li>

      
      
      <li class="previous"><a href="https://embracethered.com/blog/posts/2023/ai-injections-direct-and-indirect-prompt-injection-basics/"><span aria-hidden="true">&larr;</span> Older</a></li>
      
    </ul>
  </footer>
</article>
</main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
     
     (c) WUNDERWUZZI 2018-2023
     <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>
 
     <div style="font-size:small;font-style: italic;color:crimson">
    Disclaimer: Penetration testing requires authorization from proper stakeholders. Information on this blog is provided for research and educational purposes to advance understanding of attacks and countermeasures to help secure the Internet. 
    </div>
    </div>
</footer>
  <script src="https://embracethered.com/blog/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  



<script type="text/javascript">
  var _paq = window._paq || [];
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//wuzzi.net/anamato/inc/";
    _paq.push(['setTrackerUrl', u+'rts.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'rts.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<img src="https://wuzzi.net/anamato/inc/rts.php?idsite=1&amp;rec=1" style="border:0;" alt="" />
  
</body>
</html>

