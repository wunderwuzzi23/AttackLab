<!DOCTYPE html>
<html lang="en-us">
<head prefix="og: http://ogp.me/ns#">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  <meta property="og:title" content=" OpenAI mitigates data exfiltration vulnerability in ChatGPT &middot;  Embrace The Red" />
  
  <meta property="og:site_name" content="Embrace The Red" />
  <meta property="og:url" content="https://embracethered.com/blog/posts/2023/openai-data-exfiltration-fix/" />
  
  
  <meta property="og:type" content="article" />
  
  <meta property="og:article:published_time" content="2023-12-19T21:35:07-08:00" />
  
  <meta property="og:article:tag" content="aiml" />
  
  <meta property="og:article:tag" content="machine learning" />
  
  <meta property="og:article:tag" content="red" />
  
  <meta property="og:article:tag" content="threats" />
  
  <meta property="og:article:tag" content="ai injections" />
  
  <meta property="og:article:tag" content="chatgpt" />
  
  <meta property="og:article:tag" content="data exiltration" />
  
  

  <title>
     OpenAI mitigates data exfiltration vulnerability in ChatGPT &middot;  Embrace The Red
  </title>

  <link rel="stylesheet" href="https://embracethered.com/blog/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/main.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://embracethered.com/blog/css/github.css" />
  
  <link rel="stylesheet" href="https://embracethered.com/blog/fonts/cachedfonts.css" type="text/css">
  <link rel="shortcut icon" type="image/png" href="https://embracethered.com/blog/images/favicon.ico?" />
  <link rel="apple-touch-icon" type="image/png" href="https://embracethered.com/blog/images/favicon.png" />
  

  
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@wunderwuzzi23">
<meta name="twitter:title" content="ChatGPT: OpenAI mitigates data exfiltration vulnerability">
<meta name="twitter:description" content="Great news. It appears that OpenAI finally mitigated the image markdown data exfiltration angle.">
<meta name="twitter:image" content="https://embracethered.com/blog/images/2023/hacker-white.jpg">

<meta name="twitter:creator" content="@wunderwuzzi23">



  
</head>
<body>
    <header class="global-header"  style="background-image:url( /blog/images/bg.png )">
    <section class="header-text">
      <h1><a href="https://embracethered.com/blog/">Embrace The Red</a></h1>
      
      <div class="tag-line" style="min-width:fit-content; font-weight: 400;">
        wunderwuzzi&#39;s blog
        <br><a style="color: greenyellow; font-weight:300;text-decoration: underline; " href="https://www.amazon.com/gp/product/1838828869/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1838828869&linkCode=as2&tag=wunderwuzzi-20&linkId=b6523e937607be47499c6010ff489537">OUT NOW: Cybersecurity Attacks - Red Team Strategies</a> 
      </div>
      
      <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>

      
      <a href="https://embracethered.com/blog/" class="btn-header btn-back hidden-xs">
        <i class="fa fa-angle-left" aria-hidden="true"></i>
        &nbsp;Home
      </a>
      
    
      <a href="/blog/index.xml" class="btn-header btn-subscribe hidden-xs">
        <i class="fa fa-rss" aria-hidden="true"></i>
        &nbsp;Subscribe
      </a>
    </section>
  </header>
  <main class="container">


<article>
  <header>
    <h1 class="text-primary">OpenAI mitigates data exfiltration vulnerability in ChatGPT</h1>
    <div class="post-meta clearfix">
    
      <div class="post-date pull-left">
        Posted on
        <time datetime="2023-12-19T21:35:07-08:00">
          Dec 19, 2023
        </time>
      </div>
    
      <div class="pull-right">
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/aiml">#aiml</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/machine-learning">#machine learning</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/red">#red</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/threats">#threats</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/ai-injections">#ai injections</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/chatgpt">#chatgpt</a></span>
        
        <span class="post-tag small"><a href="https://embracethered.com/blog//tags/data-exiltration">#data exiltration</a></span>
        
      </div>
    </div>
  </header>
  <section>
    <p>OpenAI seems to have implemented a first mitigation for a well-known data exfiltration vulnerability. Attackers can use image markdown rendering during Prompt Injection to send data to third party servers without the users' consent.</p>
<p>The fix is not perfect but a step into the right direction. In this post I share what I was able to figure out so far.</p>
<p>Yesterday I was doing a live demo with a consenting victim and ChatGPT was still vulnerable to data exfiltration via image markdown injection:</p>
<p><a href="/blog/images/2023/openai-last.png"><img src="/blog/images/2023/openai-last.png" alt="OpenAI Raeuber"></a></p>
<p>Starting today it appears that a mitigation has been implemented by OpenAI. ðŸŽ‰ðŸŽ‰ðŸŽ‰</p>
<h2 id="the-mitigation">The Mitigation</h2>
<p>When the server returns an image tag with hyperlink, there is now a client side call in ChatGPT to a validation API before deciding to display an image.</p>
<p><a href="/blog/images/2023/openai-fix-3.png"><img src="/blog/images/2023/openai-fix-3.png" alt="OpenAI Mitigation"></a></p>
<p>This is the call to an endpoit called <code>url_safe</code>:</p>
<pre tabindex="0"><code>https://chat.openai.com/backend-api/conversation/[id]/url_safe
</code></pre><p>where it appends the target URL as query parameter</p>
<pre tabindex="0"><code>?url=https://wuzzi.net/r?thief=johannr@example.org
</code></pre><p>and in this case it returns:</p>
<pre tabindex="0"><code>{&quot;safe&quot;:false}
</code></pre><p><code>safe=false</code> means that it will not render the image and perform the request to the attackers server!</p>
<p>It still renders some images. Since ChatGPT is not open source the exact validation details are not known. There is some internal decision making happening when an image is considered safe and when not, maybe ChatGPT queries the Bing index to see if an image is valid and pre-existing or have another tracking capability.</p>
<p><strong>This is good news!</strong></p>
<p>As you can imagine I&rsquo;m quite happy about this improvement. Its the right thing for users and I (and others) have spent so much time this year raising awareness about this problem, and with each new feature addition the risk increased (Plugins, Browsing, Code Interpreter, GPTs,&hellip;).</p>
<p>Having a central validation API hopefully also means that Enterprises customers can configure this setting to further increase the security posture of ChatGPT for their environments.</p>
<h2 id="not-a-perfect-fix---remaining-concerns">Not a perfect fix - remaining concerns</h2>
<p>As stated it&rsquo;s not a perfect fix. There are still some obvious side channel attacks possible to leak data, and other trickeries attackers can use to send leak info via requests that pass the filter. I was able to still render some requests and use it to send data out, but it is a step in the right direction.</p>
<p>I would also suggest to OpenAI to limit the number of images that are rendered to a few images per response maximum, as that will mitigate some of these trickeries.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The validation check for safe URLs improves the security posture and allows OpenAI to monitor for attacks, which is good.</p>
<p>The decision details on when a URL is considered safe are not known, which is different to other vendors that use a open and transparent Content-Security-Policy.</p>
<p>It&rsquo;s not a 100% perfect mitigation, as some quick tests showed that bits of info can steal leak, but a step in the right direction for sure.</p>

  </section>
  <footer>
    
    
    
    <footer></footer><hr/>
    
    <ul class="pager">
      
      <li class="next disabled"><a href="#">Newer <span aria-hidden="true">&rarr;</span></a></li>
      
      
      <li class="author-contact">
        <a href="mailto:security@wunderwuzzi.net">
          <i class="fa fa-envelope-o" aria-hidden="true"></i>
          &nbsp;Contact me
        </a>
     </li>

      
      
      <li class="previous"><a href="https://embracethered.com/blog/posts/2023/openai-custom-malware-gpt/"><span aria-hidden="true">&larr;</span> Older</a></li>
      
    </ul>
  </footer>
</article>
</main>
  <footer class="container global-footer">
    <div class="copyright-note pull-left">
     
     (c) WUNDERWUZZI 2018-2023
     <div class="sns-links hidden-print">
  
  <a href="mailto:security@wunderwuzzi.net">
    <i class="fa fa-envelope"></i>
  </a>
  
  
  <a href="https://twitter.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  <a href="https://github.com/wunderwuzzi23" target="_blank">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  
  <a href="https://youtube.com/@embracethered" target="_blank">
    <i class="fa fa-youtube"></i>
  </a>
  
  
  
  <a href="/blog/index.xml" target="_blank">
    <i class="fa fa-rss"></i>
  </a>
</div>
 
     <div style="font-size:small;font-style: italic;color:crimson">
    Disclaimer: Penetration testing requires authorization from proper stakeholders. Information on this blog is provided for research and educational purposes to advance understanding of attacks and countermeasures to help secure the Internet. 
    </div>
    </div>
</footer>
  <script src="https://embracethered.com/blog/js/highlight.pack.js"></script>
  <script>
    hljs.initHighlightingOnLoad();
  </script>
  
  



<script type="text/javascript">
  var _paq = window._paq || [];
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//wuzzi.net/anamato/inc/";
    _paq.push(['setTrackerUrl', u+'rts.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'rts.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<img src="https://wuzzi.net/anamato/inc/rts.php?idsite=1&amp;rec=1" style="border:0;" alt="" />
  
</body>
</html>

